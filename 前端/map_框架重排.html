<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>中国新势力企业态势感知系统 - 产业地图</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
  <style>
    :root {
      --primary: #0A1A3A;
      --secondary: #FFD700;
      --accent: #00C1D4;
    }
    body {
      background-color: var(--primary);
    }
    .glow-effect {
      box-shadow: 0 0 20px rgba(0,193,212,0.2);
    }
  </style>
</head>
<body class="bg-[var(--primary)] text-gray-100 font-sans">
  <!-- 顶部导航栏 -->
  <nav class="fixed w-full bg-[rgba(10,26,58,0.95)] backdrop-blur-md z-50 border-b border-[rgba(255,255,255,0.1)]">
    <div class="container mx-auto px-6 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <svg class="w-8 h-8 text-[var(--secondary)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        <span class="text-xl font-bold">新势力感知系统</span>
      </div>
      <div class="hidden xl:flex space-x-8">
        <a href="index.html" class="hover:text-[var(--secondary)] transition-colors">首页</a>
        <a href="ranking.html" class="hover:text-[var(--secondary)]">新势力榜单</a>
        <div class="group relative">
          <button class="hover:text-[var(--secondary)] text-[var(--secondary)] font-semibold">
            产业链 <i class="ml-1 fas fa-chevron-down text-xs"></i>
          </button>
          <div class="absolute hidden group-hover:block bg-[#132144] p-4 rounded-lg w-48 space-y-3">
            <a href="industry.html" class="block hover:text-[var(--accent)]">产业链图谱</a>
            <a href="enterprise.html" class="block hover:text-[var(--accent)]">企业库</a>
            <a href="precision.html" class="block hover:text-[var(--accent)]">精准招商</a>
          </div>
        </div>
        <a href="map.html" class="hover:text-[var(--secondary)]">产业地图</a>
        <a href="report.html" class="hover:text-[var(--secondary)]">产业报告</a>
        <a href="news.html" class="hover:text-[var(--secondary)]">商业快讯</a>
      </div>
      <div class="flex items-center space-x-4">
        <button class="bg-[var(--secondary)] text-[var(--primary)] px-5 py-2 rounded-md font-medium hover:bg-opacity-90">
          登录
        </button>
        <i class="fas fa-bars xl:hidden text-xl"></i>
      </div>
    </div>
  </nav>

  <!-- 主体内容 -->
  <main class="pt-20 pb-16">
    <!-- 筛选区（保持原有内容） -->
    <section class="container mx-auto px-6 mb-8">
      <!-- 此处可保留筛选控件 -->
      <div class="bg-[#132144] p-4 rounded-xl glow-effect mb-4 text-sm">
        <!-- 示例：仅保留简单的产业、城市、地区下拉 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-gray-300 mb-1">产业</label>
            <select id="industryFilter" class="w-full bg-[#0A1A3A] text-gray-300 rounded-lg p-2 border border-gray-700 focus:ring-2 focus:ring-[var(--accent)]">
              <option value="">全部产业</option>
              <!-- 可由后端填充数据 -->
            </select>
          </div>
          <div>
            <label class="block text-gray-300 mb-1">城市</label>
            <select id="cityFilter" class="w-full bg-[#0A1A3A] text-gray-300 rounded-lg p-2 border border-gray-700 focus:ring-2 focus:ring-[var(--accent)]">
              <option value="">全部城市</option>
              <!-- 可由后端填充数据 -->
            </select>
          </div>
          <div>
            <label class="block text-gray-300 mb-1">地区</label>
            <select id="countyFilter" class="w-full bg-[#0A1A3A] text-gray-300 rounded-lg p-2 border border-gray-700 focus:ring-2 focus:ring-[var(--accent)]">
              <option value="">全部地区</option>
              <!-- 可由后端填充数据 -->
            </select>
          </div>
        </div>
      </div>
    </section>

    <!-- 上部：地图和右侧两个柱状图 -->
    <section class="container mx-auto px-6 mb-8">
      <div class="grid gap-6 xl:grid-cols-2">
        <!-- 左侧：地图区域（占全宽的50%） -->
        <div class="bg-[#132144] p-6 rounded-xl glow-effect">
          <h2 class="text-lg font-bold mb-4">杭州市地图</h2>
          <div id="map-container" style="width: 100%; height: 600px;">
            <!-- 地图容器（此处保持原接口不变） -->
            <canvas id="map"></canvas>
          </div>
        </div>

        <!-- 右侧：垂直排列2个柱状图 -->
        <div class="grid gap-6">
          <!-- 近十年企业数量趋势图 -->
          <div class="bg-[#132144] p-4 rounded-xl glow-effect">
            <h3 class="text-lg font-bold mb-2">近十年企业数量趋势</h3>
            <div id="yearTrendChart" style="width: 100%; height: 250px;"></div>
          </div>
          <!-- 产业链分布情况图 -->
          <div class="bg-[#132144] p-4 rounded-xl glow-effect">
            <h3 class="text-lg font-bold mb-2">产业链分布情况</h3>
            <div id="industryChainChart" style="width: 100%; height: 250px;"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 下部：新势力企业名单和各区县企业数量对比 -->
    <section class="container mx-auto px-6">
      <div class="grid gap-6 xl:grid-cols-2">
        <!-- 新势力企业名单表格 -->
        <div class="bg-[#132144] p-4 rounded-xl glow-effect overflow-auto">
          <h2 class="text-xl font-bold mb-4">新势力企业名单</h2>
          <table class="w-full table-auto min-w-[600px] text-sm leading-tight">
            <thead class="bg-[#1A2B5E]">
              <tr>
                <th class="px-4 py-3">序号</th>
                <th class="px-4 py-3">企业名称</th>
                <th class="px-4 py-3">城市</th>
                <th class="px-4 py-3">区县</th>
                <th class="px-4 py-3">新势力分</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-[#1A2B5E]" id="enterpriseListTbody">
              <!-- 数据由后端或示例数据渲染 -->
            </tbody>
          </table>
        </div>

        <!-- 各区县企业数量对比柱状图 -->
        <div class="bg-[#132144] p-4 rounded-xl glow-effect">
          <h2 class="text-xl font-bold mb-4">各区县企业数量对比</h2>
          <div id="districtChart" style="width: 100%; height: 300px;"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- JS代码：预留接口调用，初始化地图和图表 -->
  <script>
    // --------------------------- 地图初始化 ---------------------------
    // 假设后端提供了杭州地图GeoJSON和地图统计数据
    Promise.all([
      fetch('/api/hangzhouGeo.json').then(res => res.json()),
      fetch('/api/hangzhouData.json').then(res => res.json())
    ])
      .then(([geoJson, chartData]) => {
        echarts.registerMap('Hangzhou', geoJson);
        initMap(chartData.mapData);
        initYearTrendChart(chartData.yearTrend);
        initIndustryChainChart(chartData.industryChain);
        initDistrictChart(chartData.districtData);
      })
      .catch(err => {
        console.error('获取地图或图表数据出错:', err);
        // 可使用静态数据作为备用
      });

    function initMap(mapData) {
      const mapChart = echarts.init(document.getElementById('map'));
      const mapOption = {
        tooltip: { trigger: 'item', formatter: '{b}: {c}' },
        visualMap: {
          min: 0,
          max: 500,
          left: 'left',
          top: 'bottom',
          text: ['高', '低'],
          inRange: { color: ['#132144', '#00C1D4', '#FFD700'] },
          calculable: true
        },
        series: [
          {
            name: '企业数量',
            type: 'map',
            map: 'Hangzhou',
            roam: true,
            emphasis: { label: { show: true } },
            data: mapData || []
          }
        ]
      };
      mapChart.setOption(mapOption);
      window.addEventListener('resize', () => mapChart.resize());
    }

    // --------------------------- 近十年企业数量趋势 ---------------------------
    function initYearTrendChart(data) {
      const chartDom = document.getElementById('yearTrendChart');
      const yearChart = echarts.init(chartDom);
      const option = {
        tooltip: { trigger: 'axis' },
        xAxis: {
          type: 'category',
          data: ['2015','2016','2017','2018','2019','2020','2021','2022','2023','2024'],
          axisLine: { lineStyle: { color: '#ccc' } }
        },
        yAxis: {
          type: 'value',
          axisLine: { lineStyle: { color: '#ccc' } }
        },
        series: [{
          name: '企业数量',
          type: 'bar',
          data: data || [120, 150, 180, 200, 220, 240, 260, 280, 300, 320],
          itemStyle: { color: 'rgba(0,193,212,0.7)' }
        }]
      };
      yearChart.setOption(option);
      window.addEventListener('resize', () => yearChart.resize());
    }

    // --------------------------- 产业链分布情况 ---------------------------
    function initIndustryChainChart(data) {
      const chartDom = document.getElementById('industryChainChart');
      const chainChart = echarts.init(chartDom);
      const option = {
        tooltip: { trigger: 'axis' },
        xAxis: {
          type: 'category',
          data: data ? data.map(item => item.chainType) : ['类型A', '类型B', '类型C', '类型D', '类型E'],
          axisLine: { lineStyle: { color: '#ccc' } },
          axisLabel: { interval: 0, rotate: 30 }
        },
        yAxis: {
          type: 'value',
          axisLine: { lineStyle: { color: '#ccc' } }
        },
        series: [{
          name: '企业数量',
          type: 'bar',
          data: data ? data.map(item => item.count) : [300, 250, 200, 150, 100],
          itemStyle: { color: 'rgba(255,215,0,0.7)' }
        }]
      };
      chainChart.setOption(option);
      window.addEventListener('resize', () => chainChart.resize());
    }

    // --------------------------- 各区县企业数量对比 ---------------------------
    function initDistrictChart(data) {
      const chartDom = document.getElementById('districtChart');
      const districtChart = echarts.init(chartDom);
      const option = {
        tooltip: { trigger: 'axis' },
        xAxis: {
          type: 'category',
          data: data ? data.map(item => item.district) : ['区A','区B','区C','区D','区E'],
          axisLine: { lineStyle: { color: '#ccc' } },
          axisLabel: { interval: 0, rotate: 30 }
        },
        yAxis: {
          type: 'value',
          axisLine: { lineStyle: { color: '#ccc' } }
        },
        series: [{
          name: '企业数量',
          type: 'bar',
          data: data ? data.map(item => item.count) : [500, 450, 400, 350, 300],
          itemStyle: { color: 'rgba(0,193,212,0.7)' }
        }]
      };
      districtChart.setOption(option);
      window.addEventListener('resize', () => districtChart.resize());
    }

    // --------------------------- 新势力企业名单 ---------------------------
    // 模拟从后端获取数据，实际项目中请替换为真实接口地址
    function loadEnterpriseList() {
      fetch('/api/enterpriseList.json')
        .then(res => res.json())
        .then(data => {
          renderEnterpriseList(data);
        })
        .catch(err => {
          console.error('获取新势力企业名单数据出错:', err);
          renderEnterpriseList(getMockEnterpriseList());
        });
    }

    function renderEnterpriseList(dataArray) {
      const tbody = document.getElementById('enterpriseListTbody');
      tbody.innerHTML = '';
      dataArray.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#1A2B5E]';
        tr.innerHTML = `
          <td class="px-4 py-3">${index + 1}</td>
          <td class="px-4 py-3">${item.name}</td>
          <td class="px-4 py-3">${item.city}</td>
          <td class="px-4 py-3">${item.district}</td>
          <td class="px-4 py-3">${item.newForceScore}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function getMockEnterpriseList() {
      return [
        { name: '字节跳动', city: '杭州', district: '余杭区', newForceScore: 95 },
        { name: '阿里巴巴', city: '杭州', district: '滨江区', newForceScore: 93 },
        { name: '腾讯', city: '深圳', district: '南山区', newForceScore: 92 },
        { name: '百度', city: '北京', district: '海淀区', newForceScore: 90 },
        { name: '华为', city: '深圳', district: '福田区', newForceScore: 91 }
        // 更多数据...
      ];
    }

    // --------------------------- 表格数据（精准招商） ---------------------------
    function getMockData() {
      return [
        {
          name: '深度求索科技',
          industry: '人工智能',
          subTrack: '计算机视觉',
          regYear: 2018,
          financing: 'A轮',
          marketFit: 4.5,
          supplyChainFit: 3.25,
          networkFit: 5,
          resourceFit: 4.5
        },
        {
          name: '华能光电',
          industry: '半导体',
          subTrack: '芯片设计',
          regYear: 2016,
          financing: 'B轮',
          marketFit: 5,
          supplyChainFit: 4,
          networkFit: 4.5,
          resourceFit: 5
        },
        {
          name: '未来能源',
          industry: '新能源',
          subTrack: '动力电池',
          regYear: 2017,
          financing: 'C轮',
          marketFit: 5,
          supplyChainFit: 5,
          networkFit: 4.25,
          resourceFit: 5
        },
        {
          name: '瑞康生物',
          industry: '生物医药',
          subTrack: '疫苗研发',
          regYear: 2015,
          financing: '天使轮',
          marketFit: 3,
          supplyChainFit: 3.5,
          networkFit: 5,
          resourceFit: 4
        }
      ];
    }

    // 获取精准招商数据并渲染表格和图表
    (function(){
      fetch('/api/precisionList.json')
        .then(res => res.json())
        .then(data => {
          data.forEach(item => {
            item.combinedScore = (item.marketFit + item.supplyChainFit + item.networkFit + item.resourceFit) / 4;
          });
          data.sort((a, b) => b.combinedScore - a.combinedScore);
          renderTable(data);
        })
        .catch(err => {
          console.error('获取精准招商数据出错:', err);
          const mock = getMockData();
          mock.forEach(item => {
            item.combinedScore = (item.marketFit + item.supplyChainFit + item.networkFit + item.resourceFit) / 4;
          });
          mock.sort((a, b) => b.combinedScore - a.combinedScore);
          renderTable(mock);
        });
    })();

    function renderTable(dataArr) {
      const tbody = document.getElementById('precisionTbody');
      tbody.innerHTML = '';
      dataArr.forEach(item => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#1A2B5E]';
        tr.innerHTML = `
          <td class="px-4 py-3">${item.name}</td>
          <td class="px-4 py-3">${item.industry}</td>
          <td class="px-4 py-3">${item.subTrack}</td>
          <td class="px-4 py-3">${item.regYear}</td>
          <td class="px-4 py-3">${item.financing}</td>
          <td class="px-4 py-3">${renderStarRating(item.marketFit)}</td>
          <td class="px-4 py-3">${renderStarRating(item.supplyChainFit)}</td>
          <td class="px-4 py-3">${renderStarRating(item.networkFit)}</td>
          <td class="px-4 py-3">${renderStarRating(item.resourceFit)}</td>
          <td class="px-4 py-3">${renderStarRating(item.combinedScore)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // 渲染星星，四舍五入到0.5为单位，不显示1/4颗星（用半星替代）
    function renderStarRating(score) {
      // 将得分四舍五入到0.5颗星
      const rounded = Math.round(score * 2) / 2;
      const maxStars = 5;
      let fullStars = Math.floor(rounded);
      let halfStar = (rounded - fullStars) === 0.5 ? 1 : 0;
      let stars = '';

      // 绘制完整星星
      for (let i = 0; i < fullStars; i++) {
        stars += `<i class="fas fa-star" style="color: #E6C200;"></i>`;
      }
      // 绘制半颗星
      if (halfStar === 1) {
        stars += `<i class="fas fa-star-half-alt" style="color: #E6C200;"></i>`;
      }
      // 绘制空星
      for (let i = fullStars + halfStar; i < maxStars; i++) {
        stars += `<i class="far fa-star" style="color: #E6C200;"></i>`;
      }
      return stars;
    }
  </script>
</body>
</html>
